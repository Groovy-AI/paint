<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>paint.a</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    font-family: system-ui, Arial, sans-serif;
    background: #eaeaea;
}

header {
    background: #1f1f1f;
    color: white;
    padding: 12px;
    text-align: center;
    font-size: 18px;
    font-weight: 600;
}

#toolbar {
    background: #2b2b2b;
    padding: 8px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
}

#toolbar label {
    color: #ccc;
    font-size: 13px;
}

button, select, input {
    background: #3a3a3a;
    color: white;
    border: none;
    padding: 5px 8px;
    border-radius: 4px;
    font-size: 13px;
}

button:hover {
    background: #555;
}

#canvasWrapper {
    flex: 1;
    overflow: hidden;
    background: #999;
}

#canvasContainer {
    position: relative;
    width: 100%;
    height: 100%;
    transform-origin: 0 0;
}

canvas {
    position: absolute;
    inset: 0;
    touch-action: none;
    cursor: crosshair;
}
</style>
</head>

<body>

<header>paint.a</header>

<div id="toolbar">
    <label>Tool</label>
    <select id="tool">
        <option value="brush">Brush</option>
        <option value="eraser">Eraser</option>
        <option value="fill">Bucket</option>
    </select>

    <label>Color</label>
    <input type="color" id="color" value="#000000">

    <label>Size</label>
    <input type="range" id="size" min="1" max="80" value="6">

    <label>Opacity</label>
    <input type="range" id="opacity" min="0" max="1" step="0.01" value="1">

    <button id="undo">Undo</button>
    <button id="redo">Redo</button>

    <label>Layer</label>
    <select id="layerSelect"></select>

    <label>Layer Opacity</label>
    <input type="range" id="layerOpacity" min="0" max="1" step="0.01" value="1">

    <button id="toggleLayer">Hide</button>
    <button id="addLayer">Add</button>

    <label>Zoom</label>
    <input type="range" id="zoom" min="0.5" max="3" step="0.1" value="1">
</div>

<div id="canvasWrapper">
    <div id="canvasContainer"></div>
</div>

<script>
const container = document.getElementById("canvasContainer");
const layerSelect = document.getElementById("layerSelect");

let layers = [];
let activeLayer = 0;
let tool = toolSelect = document.getElementById("tool").value;

let drawing = false;
let color = colorInput = document.getElementById("color").value;
let size = sizeInput = document.getElementById("size").value;
let opacity = opacityInput = document.getElementById("opacity").value;

let undoStack = [];
let redoStack = [];

document.getElementById("tool").onchange = e => tool = e.target.value;
document.getElementById("color").oninput = e => color = e.target.value;
document.getElementById("size").oninput = e => size = e.target.value;
document.getElementById("opacity").oninput = e => opacity = e.target.value;

document.getElementById("zoom").oninput = e => {
    container.style.transform = `scale(${e.target.value})`;
};

document.getElementById("undo").onclick = undo;
document.getElementById("redo").onclick = redo;
document.getElementById("addLayer").onclick = addLayer;
document.getElementById("toggleLayer").onclick = toggleLayer;
document.getElementById("layerOpacity").oninput = setLayerOpacity;

layerSelect.onchange = () => {
    activeLayer = Number(layerSelect.value);
    document.getElementById("layerOpacity").value = layers[activeLayer].opacity;
};

function addLayer() {
    const canvas = document.createElement("canvas");
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
    container.appendChild(canvas);

    layers.push({
        canvas,
        ctx: canvas.getContext("2d"),
        visible: true,
        opacity: 1
    });

    activeLayer = layers.length - 1;
    updateLayerUI();
}

function updateLayerUI() {
    layerSelect.innerHTML = "";
    layers.forEach((_, i) => {
        const o = document.createElement("option");
        o.value = i;
        o.textContent = `Layer ${i + 1}`;
        if (i === activeLayer) o.selected = true;
        layerSelect.appendChild(o);
    });
}

function saveState() {
    undoStack.push(container.innerHTML);
    redoStack.length = 0;
}

function undo() {
    if (!undoStack.length) return;
    redoStack.push(container.innerHTML);
    container.innerHTML = undoStack.pop();
    rebuildLayers();
}

function redo() {
    if (!redoStack.length) return;
    undoStack.push(container.innerHTML);
    container.innerHTML = redoStack.pop();
    rebuildLayers();
}

function rebuildLayers() {
    layers = [...container.querySelectorAll("canvas")].map(c => ({
        canvas: c,
        ctx: c.getContext("2d"),
        visible: true,
        opacity: 1
    }));
}

container.addEventListener("pointerdown", e => {
    const layer = layers[activeLayer];
    if (!layer) return;

    saveState();

    if (tool === "fill") {
        floodFill(layer.ctx, e.offsetX, e.offsetY);
        return;
    }

    drawing = true;
    layer.ctx.beginPath();
    layer.ctx.moveTo(e.offsetX, e.offsetY);
});

container.addEventListener("pointermove", e => {
    if (!drawing) return;

    const ctx = layers[activeLayer].ctx;
    ctx.lineWidth = size;
    ctx.lineCap = "round";
    ctx.globalAlpha = opacity;

    ctx.globalCompositeOperation =
        tool === "eraser" ? "destination-out" : "source-over";

    if (tool !== "eraser") ctx.strokeStyle = color;

    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
});

container.addEventListener("pointerup", () => drawing = false);
container.addEventListener("pointerleave", () => drawing = false);

function floodFill(ctx, x, y) {
    ctx.fillStyle = color;
    ctx.globalAlpha = opacity;
    ctx.fillRect(x - 1, y - 1, 3, 3);
}

function setLayerOpacity(e) {
    const l = layers[activeLayer];
    l.opacity = e.target.value;
    l.canvas.style.opacity = l.opacity;
}

function toggleLayer() {
    const l = layers[activeLayer];
    l.visible = !l.visible;
    l.canvas.style.display = l.visible ? "block" : "none";
}

addLayer();
</script>

</body>
</html>
